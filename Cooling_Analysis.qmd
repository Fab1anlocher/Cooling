---
title: "Climate-Based Sales Analysis: Fans and Cooling Devices"
subtitle: "Temperature Impact on Product Sales in Swiss Cities"
format:
  html:
    code-fold: true
    code-summary: "Show code"
    theme: cosmo
    embed-resources: true
  pdf:
    number-sections: true
    colorlinks: true
execute:
  warning: false
  message: false
---

# Executive Summary

This analysis investigates the correlation between temperature and sales of cooling products (fans and air conditioners) in eight Swiss cities.

**Research question**: Is there a correlation between temperature and per-capita sales of cooling products?

# 1. Data & Method

We analyze sales data from Digitec Galaxus for two product categories:
- **ventilator-168** (Fans)
- **klimaanlage-280** (Air conditioners)

**Cities analyzed** (8): Zürich, Bern, Luzern, Basel, St. Gallen, Lugano, Lausanne, Genf

**Method**: Pearson correlation between average temperature (warmest month) and sales per 5,000 residents.

# 2. Data Preparation

```{r setup}
# Load packages
library(tidyverse)
library(readr)
library(ggplot2)
library(knitr)
library(corrplot)

options(scipen = 999)
theme_set(theme_minimal())
```

```{r load-data}
# Load data
temp_data <- read_delim("Temparatur und Anzahl Personen.csv", 
                        delim = ";", locale = locale(encoding = "UTF-8"))
colnames(temp_data) <- c("City", "Population", "Temperature")

sales_data <- read_csv("DigitecLive_Cleaned.csv",
                       locale = locale(encoding = "UTF-8"))
```

```{r filter-cooling-products}
# Filter for specific cooling product categories
cooling_sales <- sales_data %>%
  filter(`infos.Category` %in% c("ventilator-168", "klimaanlage-280"))

# Filter for target cities
target_cities <- c("Zürich", "Bern", "Luzern", "Basel", 
                   "St. Gallen", "Lugano", "Lausanne", "Genf")

cooling_sales_filtered <- cooling_sales %>%
  filter(cityName_clean %in% target_cities)

cat(sprintf("Total products: %d\n", nrow(cooling_sales_filtered)))
```

# 3. Results

```{r analysis}
# Aggregate sales by city and calculate per-capita sales
sales_by_city <- cooling_sales_filtered %>%
  group_by(cityName_clean) %>%
  summarise(Total_Sales = n(), .groups = 'drop') %>%
  rename(City = cityName_clean) %>%
  left_join(temp_data, by = "City") %>%
  mutate(Sales_per_5k = (Total_Sales / Population) * 5000)

kable(sales_by_city %>% 
        select(City, Temperature, Sales_per_5k) %>%
        arrange(desc(Temperature)), 
      digits = 2,
      col.names = c("City", "Temp (°C)", "Sales per 5k"),
      caption = "Sales per 5,000 Residents by City")
```

```{r plot, fig.width=10, fig.height=6}
# Visualization
ggplot(sales_by_city, aes(x = Temperature, y = Sales_per_5k)) +
  geom_point(aes(color = City), size = 5, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "red", linetype = "dashed") +
  geom_text(aes(label = City), vjust = -1.2, size = 3.5) +
  labs(
    title = "Cooling Product Sales vs. Temperature",
    x = "Temperature (°C)",
    y = "Sales per 5,000 Residents"
  ) +
  theme_minimal() +
  theme(legend.position = "none")
```

```{r correlation}
# Correlation analysis
cor_result <- cor.test(sales_by_city$Temperature, 
                       sales_by_city$Sales_per_5k, 
                       method = "pearson")

cat(sprintf("Correlation coefficient (r): %.3f\n", cor_result$estimate))
cat(sprintf("p-value: %.4f\n", cor_result$p.value))
cat(sprintf("Result: %s\n", 
            ifelse(cor_result$p.value < 0.05, 
                   "Significant correlation (p < 0.05)", 
                   "No significant correlation")))

# Linear regression
model <- lm(Sales_per_5k ~ Temperature, data = sales_by_city)
cat(sprintf("\nR²: %.3f (%.1f%% variance explained)\n", 
            summary(model)$r.squared,
            summary(model)$r.squared * 100))
```

```{r correlation-matrix, fig.width=8, fig.height=6}
# Correlation matrix
cor_data <- sales_by_city %>%
  select(Temperature, Population, Sales_per_5k)

cor_matrix <- cor(cor_data, use = "complete.obs")

corrplot(cor_matrix, 
         method = "color",
         type = "upper",
         addCoef.col = "black",
         tl.col = "black",
         tl.srt = 45,
         title = "Correlation Matrix",
         mar = c(0, 0, 2, 0))
```

```{r city-ranking}
# City ranking
ranking <- sales_by_city %>%
  mutate(
    Temp_Rank = rank(-Temperature),
    Sales_Rank = rank(-Sales_per_5k)
  ) %>%
  select(City, Temperature, Temp_Rank, Sales_per_5k, Sales_Rank) %>%
  arrange(Temp_Rank)

kable(ranking, 
      digits = 2,
      col.names = c("City", "Temp (°C)", "Temp Rank", 
                    "Sales per 5k", "Sales Rank"),
      caption = "City Ranking by Temperature and Sales")
```

# 4. Conclusion

**Hypothesis**: Higher temperatures correlate with higher per-capita sales of cooling products.

**Result**: `r ifelse(cor_result$p.value < 0.05, "CONFIRMED", "NOT CONFIRMED")` (r = `r round(cor_result$estimate, 3)`, p = `r round(cor_result$p.value, 4)`)

- **Lugano** (24.8°C): `r round(sales_by_city %>% filter(City == "Lugano") %>% pull(Sales_per_5k), 2)` sales per 5k residents
- **St. Gallen** (19.6°C): `r round(sales_by_city %>% filter(City == "St. Gallen") %>% pull(Sales_per_5k), 2)` sales per 5k residents

**Interpretation**: `r ifelse(abs(cor_result$estimate) > 0.5, "Strong", ifelse(abs(cor_result$estimate) > 0.3, "Moderate", "Weak"))` `r ifelse(cor_result$estimate > 0, "positive", "negative")` correlation between temperature and sales.

---

**Data**: Digitec Galaxus (ventilator-168, klimaanlage-280), BFS, MeteoSwiss
