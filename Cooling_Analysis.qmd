---
title: "Single-Person Household Product Analysis"
subtitle: "E-Readers, Coffee Machines & Microwaves in Swiss Cantons"
format:
  html:
    code-fold: true
    code-summary: "Show code"
    theme: cosmo
    embed-resources: true
  pdf:
    number-sections: true
    colorlinks: true
execute:
  warning: false
  message: false
---

# Executive Summary

This analysis investigates the correlation between the proportion of single-person households and sales of three product categories in Swiss cantons:
- **E-Readers** (481 sales)
- **Coffee Machines** (170 sales)
- **Microwaves** (145 sales)

**Research question**: Which of these products shows the strongest correlation with single-person household rates?

**Hypothesis**: Products typically used by individuals living alone will show higher per-capita sales in cantons with more single-person households.

# 1. Data & Method

We analyze sales data from Digitec Galaxus for three product categories and compare them with single-person household rates across Swiss cantons.

**Product categories**:
1. **E-Readers** (ereader-1138): Digital reading devices - potentially popular with solo readers
2. **Coffee Machines** (kaffeevollautomat-125): Single-serve capability - convenient for one person
3. **Microwaves** (mikrowelle-130): Quick individual meals - typical for solo living

**Data sources**:
- Product sales by canton (Digitec Galaxus)
- Single-person household rates and population by canton (BFS 2024)

**Method**: Pearson correlation between single-person household percentage and sales per 5,000 residents for each product category.

# 2. Data Preparation

```{r setup}
# Load packages
library(tidyverse)
library(readr)
library(ggplot2)
library(knitr)
library(corrplot)

options(scipen = 999)
theme_set(theme_minimal())
```

```{r load-data}
# Load household data
household_data <- read_delim("Einpersonenhaushalt.csv", 
                             delim = ";", 
                             locale = locale(encoding = "UTF-8"))

# Rename columns for easier handling
colnames(household_data) <- c("Canton_ID", "Canton", "Single_Household_Pct", "Population")

# Load sales data
sales_data <- read_csv("DigitecLive_Cleaned.csv",
                       locale = locale(encoding = "UTF-8"))

kable(household_data, 
      digits = 1,
      format.args = list(big.mark = "'"),
      caption = "Single-Person Household Rates by Canton")
```

```{r filter-gaming-headsets}
# Filter for three product categories
ereader_sales <- sales_data %>%
  filter(`infos.Category` == "ereader-1138")

coffee_sales <- sales_data %>%
  filter(`infos.Category` == "kaffeevollautomat-125")

microwave_sales <- sales_data %>%
  filter(`infos.Category` == "mikrowelle-130")

# Display sample counts
cat("E-Readers:", nrow(ereader_sales), "sales\n")
cat("Coffee Machines:", nrow(coffee_sales), "sales\n")
cat("Microwaves:", nrow(microwave_sales), "sales\n")
cat("\nUnique cantons in data:", length(unique(sales_data$canton)), "\n")
```

# 3. Results

```{r analysis}
# Prepare canton mapping
canton_mapping <- c(
  "ZH" = "Zürich", "BE" = "Bern", "LU" = "Luzern", "UR" = "Uri",
  "SZ" = "Schwyz", "OW" = "Obwalden", "NW" = "Nidwalden", "GL" = "Glarus",
  "ZG" = "Zug", "FR" = "Freiburg", "SO" = "Solothurn", "BS" = "Basel-Stadt",
  "BL" = "Basel-Landschaft", "SH" = "Schaffhausen", "AR" = "Appenzell Ausserrhoden",
  "AI" = "Appenzell Innerrhoden", "SG" = "St. Gallen", "GR" = "Graubünden",
  "AG" = "Aargau", "TG" = "Thurgau", "TI" = "Tessin", "VD" = "Waadt",
  "VS" = "Wallis", "NE" = "Neuenburg", "GE" = "Genf", "JU" = "Jura"
)

# Function to aggregate sales by canton
aggregate_by_canton <- function(sales_df, product_name) {
  sales_df %>%
    group_by(canton) %>%
    summarise(Total_Sales = n(), .groups = 'drop') %>%
    mutate(Canton_Full = canton_mapping[canton]) %>%
    select(Canton_Full, Total_Sales) %>%
    rename(!!product_name := Total_Sales)
}

# Aggregate each product category
ereader_agg <- aggregate_by_canton(ereader_sales, "EReader_Sales")
coffee_agg <- aggregate_by_canton(coffee_sales, "Coffee_Sales")
microwave_agg <- aggregate_by_canton(microwave_sales, "Microwave_Sales")

# Merge all products with household data
analysis_data <- household_data %>%
  left_join(ereader_agg, by = c("Canton" = "Canton_Full")) %>%
  left_join(coffee_agg, by = c("Canton" = "Canton_Full")) %>%
  left_join(microwave_agg, by = c("Canton" = "Canton_Full")) %>%
  mutate(
    EReader_Sales = replace_na(EReader_Sales, 0),
    Coffee_Sales = replace_na(Coffee_Sales, 0),
    Microwave_Sales = replace_na(Microwave_Sales, 0),
    EReader_per_5k = (EReader_Sales / Population) * 5000,
    Coffee_per_5k = (Coffee_Sales / Population) * 5000,
    Microwave_per_5k = (Microwave_Sales / Population) * 5000
  )

kable(analysis_data %>% 
        select(Canton, Single_Household_Pct, EReader_per_5k, Coffee_per_5k, Microwave_per_5k) %>%
        arrange(desc(Single_Household_Pct)), 
      digits = 2,
      col.names = c("Canton", "Single HH %", "E-Reader", "Coffee", "Microwave"),
      caption = "Product Sales per 5,000 Residents by Canton")
```

```{r plot, fig.width=12, fig.height=10}
# Prepare data for plotting
plot_data <- analysis_data %>%
  select(Canton, Single_Household_Pct, EReader_per_5k, Coffee_per_5k, Microwave_per_5k) %>%
  pivot_longer(
    cols = c(EReader_per_5k, Coffee_per_5k, Microwave_per_5k),
    names_to = "Product",
    values_to = "Sales_per_5k"
  ) %>%
  mutate(Product = case_when(
    Product == "EReader_per_5k" ~ "E-Reader",
    Product == "Coffee_per_5k" ~ "Coffee Machine",
    Product == "Microwave_per_5k" ~ "Microwave"
  ))

# Visualization with facets
ggplot(plot_data, aes(x = Single_Household_Pct, y = Sales_per_5k)) +
  geom_point(aes(color = Product), size = 3, alpha = 0.7) +
  geom_smooth(method = "lm", se = TRUE, color = "darkgray", linetype = "dashed", linewidth = 0.8) +
  facet_wrap(~Product, scales = "free_y", ncol = 1) +
  labs(
    title = "Product Sales vs. Single-Person Household Rate by Canton",
    x = "Single-Person Household Rate (%)",
    y = "Sales per 5,000 Residents"
  ) +
  theme_minimal() +
  theme(
    legend.position = "none",
    strip.text = element_text(size = 12, face = "bold")
  )
```

```{r correlation}
# Correlation analysis for all three products
cor_ereader <- cor.test(analysis_data$Single_Household_Pct, analysis_data$EReader_per_5k)
cor_coffee <- cor.test(analysis_data$Single_Household_Pct, analysis_data$Coffee_per_5k)
cor_microwave <- cor.test(analysis_data$Single_Household_Pct, analysis_data$Microwave_per_5k)

# Create summary table
correlation_summary <- data.frame(
  Product = c("E-Reader", "Coffee Machine", "Microwave"),
  Correlation = c(cor_ereader$estimate, cor_coffee$estimate, cor_microwave$estimate),
  P_Value = c(cor_ereader$p.value, cor_coffee$p.value, cor_microwave$p.value),
  Significant = c(
    ifelse(cor_ereader$p.value < 0.05, "Yes", "No"),
    ifelse(cor_coffee$p.value < 0.05, "Yes", "No"),
    ifelse(cor_microwave$p.value < 0.05, "Yes", "No")
  )
)

kable(correlation_summary,
      digits = 4,
      col.names = c("Product", "Correlation (r)", "p-value", "Significant (p<0.05)"),
      caption = "Correlation Results: Single-Person Households vs. Product Sales")
```

```{r correlation-matrix, fig.width=10, fig.height=8}
# Correlation matrix for all variables
cor_data <- analysis_data %>%
  select(Single_Household_Pct, EReader_per_5k, Coffee_per_5k, Microwave_per_5k)

colnames(cor_data) <- c("Single HH %", "E-Reader", "Coffee", "Microwave")

cor_matrix <- cor(cor_data, use = "complete.obs")

corrplot(cor_matrix, 
         method = "color",
         type = "upper",
         addCoef.col = "black",
         tl.col = "black",
         tl.srt = 45,
         number.cex = 1.2,
         title = "Correlation Matrix: All Products",
         mar = c(0, 0, 2, 0))
```

```{r canton-ranking}
# Canton ranking by single-household rate
ranking <- analysis_data %>%
  select(Canton, Single_Household_Pct, EReader_per_5k, Coffee_per_5k, Microwave_per_5k) %>%
  arrange(desc(Single_Household_Pct))

kable(ranking, 
      digits = 2,
      col.names = c("Canton", "Single HH %", "E-Reader", "Coffee", "Microwave"),
      caption = "Canton Ranking by Single-Household Rate with Product Sales per 5k")
```

# 4. Conclusion

**Research Question**: Which product shows the strongest correlation with single-person household rates?

**Results**:
- **E-Reader**: r = `r round(cor_ereader$estimate, 3)`, p = `r round(cor_ereader$p.value, 4)` - `r ifelse(cor_ereader$p.value < 0.05, "SIGNIFICANT ✓", "NOT SIGNIFICANT")`
- **Coffee Machine**: r = `r round(cor_coffee$estimate, 3)`, p = `r round(cor_coffee$p.value, 4)` - `r ifelse(cor_coffee$p.value < 0.05, "SIGNIFICANT ✓", "NOT SIGNIFICANT")`
- **Microwave**: r = `r round(cor_microwave$estimate, 3)`, p = `r round(cor_microwave$p.value, 4)` - `r ifelse(cor_microwave$p.value < 0.05, "SIGNIFICANT ✓", "NOT SIGNIFICANT")`

**Key Findings**:
- Canton with highest single-household rate: `r analysis_data %>% arrange(desc(Single_Household_Pct)) %>% slice(1) %>% pull(Canton)` (`r round(analysis_data %>% arrange(desc(Single_Household_Pct)) %>% slice(1) %>% pull(Single_Household_Pct), 1)`%)
- Strongest correlation product: `r correlation_summary %>% arrange(desc(abs(Correlation))) %>% slice(1) %>% pull(Product)`

**Interpretation**:
`r if(any(correlation_summary$P_Value < 0.05)) {
  sig_products <- correlation_summary %>% filter(P_Value < 0.05) %>% pull(Product)
  paste0("Significant correlation found for: ", paste(sig_products, collapse = ", "), ". ")
} else {
  "No significant correlations found. "
}`
`r paste0("The ", correlation_summary %>% arrange(desc(abs(Correlation))) %>% slice(1) %>% pull(Product), " shows the strongest (", ifelse(correlation_summary %>% arrange(desc(abs(Correlation))) %>% slice(1) %>% pull(Correlation) > 0, "positive", "negative"), ") relationship with single-person households.")`

**Possible explanations**:
1. **Urban lifestyle**: Higher single-household rates in cities correlate with different consumer behaviors
2. **Demographics**: Age and income of people living alone influence product preferences
3. **Living space**: Smaller apartments may drive demand for compact appliances
4. **Independence**: Solo living requires individual-sized appliances and personal devices

---

**Data**: Digitec Galaxus (E-Readers, Coffee Machines, Microwaves), BFS (Single-Person Households 2024)
